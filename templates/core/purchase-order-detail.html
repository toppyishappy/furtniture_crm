{% extends 'base.html' %}
{% block style %}
<style>
    @media print {
        #btnPrint {
            display: none;
        }
    }
</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
{% endblock %}
{% block content %}
<div class="modal fade" id="myModal_Confirm">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">อนุมัติข้อมูล</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                ยืนยันข้อมูลการอนุมัติข้อมูล ?
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
                <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal">ยืนยัน</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="myModal_Reject">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">ไม่อนุมัติข้อมูล</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                ปฏิเสธการอนุมัติข้อมูล ?
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
                <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal">ยืนยัน</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">อนุมัติข้อมูล</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                ยืนยันข้อมูลการอนุมัติข้อมูล ?
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
                <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal">ยืนยัน</button>
            </div>

        </div>
    </div>
</div>

<div class="d-flex justify-content-end mb-3">
    <div>
        <button type="button" class="btn btn-primary m-2" id="btnPrint" onclick="PrintPage()">Print</button>
        {% if user.role == 2 and status == 2 %}
            <button type="button" class="btn btn-success m-2 " id="btnPrint"
                onclick="update_status('{{sale_order.id}}','confirm')">Confirm</button>
            <button type="button" class="btn btn-danger m-2" id="btnPrint"
                onclick="update_status('{{sale_order.id}}','reject')">Reject</button>
        {% endif %}
        <button type="button" class="btn btn-warning m-2" id="btnPrint" onclick="RedirectEditPage({{id}})">Edit</button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="#">Separated link</a></li>
        </ul>
    </div>
</div>
<div class="d-flex justify-content-end mb-3">
    Status : <div><span class="badge rounded-pill bg-success">{{status}}</span></div>
</div>

<div class="mb-4">
    <div class="row mt-3">
        <div class="col-6">
            <img style='height: 100px;' src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5oS_MzgZ5NOSyfW-3BtWWWGBmwdKwOZJFD_N5H3aJPPxS4KG9XV99VX6IFsDhH1HPufo&usqp=CAU" alt="">
        </div>
        <div class="col-6" style="text-align: end;">
            <h4>ใบสั่งซื้อสินค้า {{po_id}}</h4>
            <div>ที่อยู่บริษัท</div>
        </div>
    </div>
    <!-- section customer -->
    <div class="row mt-3">
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">วันที่</label>
            <div>{{sale_order.form_date}}</div>
        </div>
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">ชื่อลูกค้า</label>
            <div>{{customer.fullname}}</div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">สถานที่</label>
            <div>{{work_location.name}}</div>
        </div>
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">เบอร์โทรศัพท์</label>
            <div>{{customer.tel}}</div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">กำหนดส่งสินค้า</label>
            <div>{{delivery_date}}</div>
        </div>
        <div class="col-6">
            <label for="exampleFormControlInput1" class="form-label">ที่อยู่</label>
            <div>{{sale_order.delivery_address}} {{sale_order.district}} {{sale_order.amphoe}} {{sale_order.province}} {{sale_order.zipcode}}</div>
        </div>
    </div>
    <!-- end section -->

    <!-- item information -->

    <div class="row card-body mt-3">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">แบบ</th>
                    <th scope="col">วัสดุ/รหัส</th>
                    <th scope="col">ประเภท</th>
                    <th scope="col">สี</th>
                    <th scope="col">ไซส์</th>
                    <th scope="col">จำนวน</th>
                    <th scope="col">ราคา</th>
                </tr>
            </thead>
            <tbody>
                {% for item in objects %}
                <tr class="">
                    <td>{{item.model.name}}</td>
                    <td>{{item.material.name}}</td>
                    <td>{{item.color.name}}</td>
                    <td>{{item.type.name}}</td>
                    <td>{{item.size|default:"-"}}</td>
                    <td>{{item.amount}}</td>
                    <td>{{item.price}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <hr />
<!-- end section -->

<div class="row mt-3">
    <div class="col-3">
        <label for="exampleFormControlInput1" class="form-label">การชำระเงิน</label>
        <div>{{payment_method}}</div>
        <!-- <input class="form-control" type="text" value="{{payment_method}}"
            aria-label="Disabled input example" disabled readonly> -->
    </div>
    <div class="col-3">
        <label for="exampleFormControlInput1" class="form-label">รวม</label>
        <div>{{price_detail.summary_price}}</div>
        <!-- <input class="form-control" type="text" value="{{price_detail.summary_price}}"
            aria-label="Disabled input example" disabled readonly> -->
    </div>
    <div class="col-3">
        <label for="exampleFormControlInput1" class="form-label">มัดจำ</label>
        <div>{{price_detail.deposit_price}}</div>
        <!-- <input class="form-control" type="text" value="{{price_detail.deposit_price}}"
            aria-label="Disabled input example" disabled readonly> -->
    </div>
    <div class="col-3">
        <label for="exampleFormControlInput1" class="form-label">คงเหลือ</label>
        <div>{{price_detail.remain_price}}</div>
        <!-- <input class="form-control" type="text" value="{{price_detail.remain_price}}"
            aria-label="Disabled input example" disabled readonly> -->
    </div>
</div>
<div class="row mt-3">
    <div class="col-6">
        <label for="exampleFormControlInput1" class="form-label">หมายเหตุ</label>
        <textarea class="form-control" style="height: 150px;" aria-label="Disabled input example" 
        disabled readonly>{{sale_order.comment}}</textarea>
    </div>
    <div class="col-6">
        <label class="form-label">ลายมือชื่อ</label>
        <div>
            <img src="{{signauter_url}}" alt="" style="height: 100px;">
        </div>
        <!-- <input class="form-control" style="height: 150px;" type="image" src="{{signauter_url}}" alt="" disabled
            readonly> -->
    </div>
</div>
</div>

<!-- section image -->
{% for item in objects %}
<div class="row mt-3">
    <!-- <div class="d-flex" style="overflow-x: scroll;"> -->
        <div class="me-2 border">
        {% for img in item.images %}
            <img style="height: 200px;" src="{{img.image.url}}" alt="">
            {% endfor %}
        </div>
    <!-- </div> -->
</div>
{% endfor %}
<!-- end section -->
{% endblock %}
{% block script %}
<script>
    const update_status = (orderid, action) => {
        var confirmText = '';
        if (action == "confirm") {
            confirmText = 'Yes, confirm it!'
        } else {
            confirmText = 'Yes, delete it!';
        }
        Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: confirmText
            })
            .then(async (result) => {
                if (result.isConfirmed) {
                    debugger;
                    const data = {
                        'action': 'confirm',
                        'order_id': orderid
                    }
                    const path = '/api/admin-management'
                    const res = await postData(path, data)
                    if (res.ok) {
                        window.location.href = '/admin-management/';
                    }
                }
            })
    }
</script>
<script>
    function RedirectEditPage(itemId) {
        const urlParams = new URLSearchParams(window.location.search);
        const htmla = window.location.hostname;
        window.location.href = `/purchase-order/edit/${itemId}`
    }

    function PrintPage() {
        window.print();
    }
</script>
{% endblock %}