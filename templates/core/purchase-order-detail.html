{% extends 'base.html' %}
{% block style %}
    <style>
        @media print{
            #btnPrint{
                display: none;
            }
        }
    </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
{% endblock %}
{% block content %}

<div class="modal fade" id="myModal_Confirm">
    <div class="modal-dialog">
        <div class="modal-content">
    
            <!-- Modal Header -->
            <div class="modal-header">
            <h4 class="modal-title">อนุมัติข้อมูล</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
    
            <!-- Modal body -->
            <div class="modal-body">
            ยืนยันข้อมูลการอนุมัติข้อมูล ?
            </div>
    
            <!-- Modal footer -->
            <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal" >ยืนยัน</button>
            </div>
    
        </div>
    </div>
  </div>

  <div class="modal fade" id="myModal_Reject">
    <div class="modal-dialog">
        <div class="modal-content">
    
            <!-- Modal Header -->
            <div class="modal-header">
            <h4 class="modal-title">ไม่อนุมัติข้อมูล</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
    
            <!-- Modal body -->
            <div class="modal-body">
            ปฏิเสธการอนุมัติข้อมูล ?
            </div>
    
            <!-- Modal footer -->
            <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal" >ยืนยัน</button>
            </div>
    
        </div>
    </div>
  </div>

  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
    
            <!-- Modal Header -->
            <div class="modal-header">
            <h4 class="modal-title">อนุมัติข้อมูล</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
    
            <!-- Modal body -->
            <div class="modal-body">
            ยืนยันข้อมูลการอนุมัติข้อมูล ?
            </div>
    
            <!-- Modal footer -->
            <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="button" class="btn btn-primary button-shadow" data-bs-dismiss="modal" >ยืนยัน</button>
            </div>
    
        </div>
    </div>
  </div>
  
    <div class="d-flex justify-content-end mb-3">
        <div class="btn-group">
            <button type="button" class="btn btn-primary m-2" id="btnPrint" onclick="PrintPage()">Print</button>
            <button type="button" class="btn btn-success m-2 " id="btnPrint" onclick="update_status('{{sale_order.id}}','confirm')">Confirm</button>
            <button type="button" class="btn btn-danger m-2" id="btnPrint" onclick="update_status('{{sale_order.id}}','reject')">Reject</button>
            <button type="button" class="btn btn-warning m-2" id="btnPrint" onclick="RedirectEditPage()">Edit</button>
            <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Separated link</a></li>
            </ul>
        </div>
    </div>
    <div class="d-flex justify-content-end mb-3">
        Status : <span class="badge rounded-pill bg-success">{{status}}</span>
    </div>
    <div>ใบสั่งซื้อสินค้า</div>
    <!-- section customer -->
    <div class="row mt-3">
        <div class="col-6">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">วันที่</label>
                </div>
                <div class="col">
                    {{sale_order.form_date}}
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">สถานที่จัดงาน</label>
                </div>
                <div class="col">
                    {{work_location.name}}
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-6">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">ชื่อลุกค้า</label>
                </div>
                <div class="col">
                    {{customer.fullname}}
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">เบอร์โทรศัพท์</label>
                </div>
                <div class="col">
                    {{customer.tel}}
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-6">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">กำหนดส่งสินค้า</label>
                </div>
                <div class="col">
                    {{delivery_date}}
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="col-4">ที่อยู่จัดส่ง </div>
                        <div class="col">{{sale_order.delivery_address}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr/>
    <!-- end section -->

    <!-- item information -->
    <!-- <div class="row">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">แบบ</th>
                    <th scope="col">ประเภท</th>
                    <th scope="col">วัสดุ</th>
                    <th scope="col">สี</th>
                    <th scope="col">จำนวน</th>
                    <th scope="col">ราคา</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>Caro 2RR-MOTOR กว้าง 2.10 ลึก 0.90 ม.</td>
                    <td>2RR</td>
                    <td>หนังแท้อิตาลีทั้งตัว</td>
                    <td>5478</td>
                    <td>1</td>
                    <td>30000</td>
                </tr>
                <tr>
                    <th scope="row">1</th>
                    <td>Caro 2RR-MOTOR กว้าง 2.10 ลึก 0.90 ม.</td>
                    <td>2RR</td>
                    <td>หนังแท้อิตาลีทั้งตัว</td>
                    <td>5478</td>
                    <td>1</td>
                    <td>30000</td>
                </tr>
                <tr>
                    <th scope="row">1</th>
                    <td>Caro 2RR-MOTOR กว้าง 2.10 ลึก 0.90 ม.</td>
                    <td>2RR</td>
                    <td>หนังแท้อิตาลีทั้งตัว</td>
                    <td>5478</td>
                    <td>1</td>
                    <td>30000</td>
                </tr>
            </tbody>
        </table>
    </div> -->
    
    <div class="row mb-3">
        <div class="container" style="overflow-y: scroll; height: 500px;">
            {% for item in objects %}
            <div class="row">
                <div class="col-8">
                    <div class="row">
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >แบบ</span>
                                <span>{{item.model.name}}</span>
                            </div>
                        </div>
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >วัสดุ/รหัส</span>
                                <span>{{item.material.name}}</span>
                            </div>
                        </div>
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >สี</span>
                                <span>{{item.color.name}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >ประเภท</span>
                                <span>{{item.type.name}}</span>
                            </div>
                        </div>
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >จำนวน</span>
                                <span>{{item.amount}}</span>
                            </div>
                        </div>
                        <div class="col mt-3">
                            <div class="d-flex-inline">
                                <span >ราคา</span>
                                <span>{{item.price}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="d-flex" style="overflow-x: scroll;">
                    {% for img in item.images %}
                        <div class="me-2 border">
                            <img src="{{img.image.url}}" alt="">
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <hr/>
    <!-- end section -->
    <div class="row">
        <div class="col">
            <div class="row">
                <div class="col-3 m-auto">
                    <label for="exampleFormControlInput1" class="">การชำระเงิน</label>
                </div>
                <div class="col">
                    {{sale_order.payment_method}}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div>
                <label for="">หมายเหตุ </label>
                {{sale_order.comment}}
            </div>
        </div>
        <div class="col">
            <div class="d-flex">
                <label for="">รวม</label>
                <label for="">{{price_detail.summary_price}}</label>
            </div>
            <div class="d-flex">
                <label for="">มัดจำ</label>
                <label for="">{{price_detail.deposit_price}}</label>
            </div>
            <div class="d-flex">
                <label for="">คงเหลือ</label>
                <label for="">{{price_detail.remain_price}}</label>
            </div>
        </div>
    </div>
    <div class="row">
        <div>
            <label>ลายมือชื่อ</label>
            <img src="https://upic.me/i/a6/hd003.jpg" alt="" style="width: 200px;" >
        </div>
    </div>
{% endblock %}
{% block script %}
<script>
    const update_status = (orderid,action) => {
        var confirmText = '';
        if(action == "confirm")
        {
            confirmText = 'Yes, confirm it!'
        }
        else
        {
            confirmText = 'Yes, delete it!';
        }
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: confirmText
      })
    .then( async(result) => {
      if (result.isConfirmed) {
        debugger;
        const data = {
          'action': 'confirm',
          'order_id': orderid
        }
        const path = '/api/admin-management'
        const res = await postData(path, data)
        if(res.ok){
          window.location.href = '/admin-management/';
        }
      }
    })
    }
  </script>
<script>
    function RedirectEditPage(){
    const urlParams = new URLSearchParams(window.location.search);
    const htmla = window.location.hostname;
    window.location.href = `/purchase-order/edit/1`
  }

  function PrintPage(){
        window.print();
    }
</script>
{% endblock %}